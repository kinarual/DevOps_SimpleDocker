# Docker Project

## **Part 1. Ready-made docker**

Подготовка:

![Узнаем информацию об ОС](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled.png)

Узнаем информацию об ОС

![Устанавливаем docker](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%201.png)

Устанавливаем docker

![Пробуем установить image nginx → ошибка → редактируем доступы и рестартим докер + перезагружаем ВМ с помощью reboot](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%202.png)

Пробуем установить image nginx → ошибка → редактируем доступы и рестартим докер + перезагружаем ВМ с помощью reboot

![Установка образа nginx с помощью **docker pull** команды](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%203.png)

Установка образа nginx с помощью **docker pull** команды

![Проверка установленных образов с помощью команды **docker images**](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%204.png)

Проверка установленных образов с помощью команды **docker images**

![Запускаем образ в фоновом режиме (с помощью флага -d) и получаем в выводе container ID](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%205.png)

Запускаем образ в фоновом режиме (с помощью флага -d) и получаем в выводе container ID

![Проверяем запущенные контейнеры с помощью **docker ps** (-q выводит только обрезанный ID контейнера, —no-trunc не обрезает вывод в консоль, и в сочетании с флагом -q мы видим полный ID контейнера) ](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%206.png)

Проверяем запущенные контейнеры с помощью **docker ps** (-q выводит только обрезанный ID контейнера, —no-trunc не обрезает вывод в консоль, и в сочетании с флагом -q мы видим полный ID контейнера) 

![Выводим информацию о контейнере с помощью **docker inspect** (вывод по дефолту в формате json файла + очень детальный, будем ограничивать в следующем шаге)](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%207.png)

Выводим информацию о контейнере с помощью **docker inspect** (вывод по дефолту в формате json файла + очень детальный, будем ограничивать в следующем шаге)

![С помощью флага —size добавляем информацию про размеру контейнеров (это отражение в json файле)](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%208.png)

С помощью флага —size добавляем информацию про размеру контейнеров (это отражение в json файле)

![Вывод только информации о размере: 1) файлов в байтах, которые создавались или изменялись в контейнере в сравнении с базовым образом (SizeRw); 2) всех файлов в контейнере в байтах (SizeRootFs)](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%209.png)

Вывод только информации о размере: 1) файлов в байтах, которые создавались или изменялись в контейнере в сравнении с базовым образом (SizeRw); 2) всех файлов в контейнере в байтах (SizeRootFs)

![Вывод из json вывода информации о смапенных портах и IP контейнера](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2010.png)

Вывод из json вывода информации о смапенных портах и IP контейнера

![Останавливаем контейнер с помощью **docker stop** и отражаем информацию о запущенных контейнерах (их нет, т.к. контейнер peaceful_roentgen мы отключили)](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2011.png)

Останавливаем контейнер с помощью **docker stop** и отражаем информацию о запущенных контейнерах (их нет, т.к. контейнер peaceful_roentgen мы отключили)

![Запускаем nginx образ с помощью **docker run** и с флагом -p мапим порт контейнера и порт хоста](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2012.png)

Запускаем nginx образ с помощью **docker run** и с флагом -p мапим порт контейнера и порт хоста

![В адресной строке браузера забиваем адрес хоста с портом 80 [***localhost:80***](http://localhost:80), и видим, что сервер работает, т.е. образ запущен и замапен успешно ](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2013.png)

В адресной строке браузера забиваем адрес хоста с портом 80 [***localhost:80***](http://localhost:80), и видим, что сервер работает, т.е. образ запущен и замапен успешно 

![Перезапускаем контейнер и проверяем с помощью команды docker ps, что контейнер запущен](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2014.png)

Перезапускаем контейнер и проверяем с помощью команды docker ps, что контейнер запущен

## **Part 2. Operations with container**

![Заходим в оболочку запущенного контейнера с помощью **docker exec** (флаг **-i** оставляет стандартный ввод открытым, **-t** выделяет псевдотерминал) - на скрине видно, что под дефолтным пользователем root мы уже находимся в оболочке контейнера, и терминальные команды выполняются внутри него. Открываем с помощью **cat** файл с конфигурациями nginx.](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2015.png)

Заходим в оболочку запущенного контейнера с помощью **docker exec** (флаг **-i** оставляет стандартный ввод открытым, **-t** выделяет псевдотерминал) - на скрине видно, что под дефолтным пользователем root мы уже находимся в оболочке контейнера, и терминальные команды выполняются внутри него. Открываем с помощью **cat** файл с конфигурациями nginx.

![Создаем файл nginx.conf на локальной машине и копируем его в nginx с помощью docker cp](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2016.png)

Создаем файл nginx.conf на локальной машине и копируем его в nginx с помощью docker cp

![Перезапускаем nginx внутри контейнера с помощью docker exec](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2017.png)

Перезапускаем nginx внутри контейнера с помощью docker exec

![Конфигурации server в nginx.conf](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2018.png)

Конфигурации server в nginx.conf

![Проверяем, что возвращается по адресу localhost/status](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2019.png)

Проверяем, что возвращается по адресу localhost/status

![Экспортируем контейнер в container.tar с помощью **docker export**. На скрине видно, что контейнер еще запущен, далее происходит экспорт в .tar и с помощью команды **ls** отражается, что .tar есть в директории](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2020.png)

Экспортируем контейнер в container.tar с помощью **docker export**. На скрине видно, что контейнер еще запущен, далее происходит экспорт в .tar и с помощью команды **ls** отражается, что .tar есть в директории

![Останавливаем контейнер и проверяем с помощью **docker ps**](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2021.png)

Останавливаем контейнер и проверяем с помощью **docker ps**

![Удаляем образ nginx с помощью команды **docker rmi** с флагом **-f** (т.к. есть контейнер, который использует этот образ) - судя по выводу образ удалился. С помощью команды **docker ps -all** (отражающей даже остановленные контейнеры), видим, что контейнер не был удален.](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2022.png)

Удаляем образ nginx с помощью команды **docker rmi** с флагом **-f** (т.к. есть контейнер, который использует этот образ) - судя по выводу образ удалился. С помощью команды **docker ps -all** (отражающей даже остановленные контейнеры), видим, что контейнер не был удален.

![Удаляем остановленный контейнер](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2023.png)

Удаляем остановленный контейнер

![Импортируем контейнер из файла **container.tar** с помощью команды **docker import** и запускаем контейнер с помощью **docker run**](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2024.png)

Импортируем контейнер из файла **container.tar** с помощью команды **docker import** и запускаем контейнер с помощью **docker run**

![Проверяем, что контейнер запущен](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2025.png)

Проверяем, что контейнер запущен

![Проверяем, что возвращается по адресу [localhost/status](http://localhost/status) страница со статусом сервера nginx](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2026.png)

Проверяем, что возвращается по адресу [localhost/status](http://localhost/status) страница со статусом сервера nginx

## **Part 3. Mini web server**

![Устанавливаем пакеты для подключения библиотеки fcgi ](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2027.png)

Устанавливаем пакеты для подключения библиотеки fcgi 

![После запуска скрипта [run.sh](http://run.sh) [localhost:81](http://localhost:81) возвращает  Hello, World!](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2028.png)

После запуска скрипта [run.sh](http://run.sh) [localhost:81](http://localhost:81) возвращает  Hello, World!

![Проверим что на каких портах](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2029.png)

Проверим что на каких портах

![Скрин страницы по адресу localhost:81](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2030.png)

Скрин страницы по адресу localhost:81

## **Part 4. Your own docker**

![Билдим образ с помощью инструкций из Докерфайла](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/63050a1a-de7a-4217-9f99-044b50970e08.png)

Билдим образ с помощью инструкций из Докерфайла

![Смотрим, что образ создался, прослушиваем порты, и билдим контейнер по образу, маппим порты 80:81 и маунтим конфигурационные файлы - контейнер создался и включен](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2031.png)

Смотрим, что образ создался, прослушиваем порты, и билдим контейнер по образу, маппим порты 80:81 и маунтим конфигурационные файлы - контейнер создался и включен

![Проверяем работу [localhost:81](http://localhost:81) с контейнера, :80 с локалки и страницы статуса с локалки через порт 80 по заданию](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2032.png)

Проверяем работу [localhost:81](http://localhost:81) с контейнера, :80 с локалки и страницы статуса с локалки через порт 80 по заданию

## **Part 5. Dockle**

1. Скачиваем dockle

```bash
#Ubuntu
$ VERSION=$(
 curl --silent "https://api.github.com/repos/goodwithtech/dockle/releases/latest" | \
 grep '"tag_name":' | \
 sed -E 's/.*"v([^"]+)".*/\1/' \
) && curl -L -o dockle.deb https://github.com/goodwithtech/dockle/releases/download/v${VERSION}/dockle_${VERSION}_Linux-64bit.deb
$ sudo dpkg -i dockle.deb && rm dockle.deb
```

1. С помощью команды dockle myserver:test проверяем замечания. Нам дали healthcheck + enable content trust.
2. После добавления healthcheck в докерфайл остается одно замечание:

![Результат команды dockle после добавления healthcheck в докерфайл](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2033.png)

Результат команды dockle после добавления healthcheck в докерфайл

1. Для устранения этого замечания перед билдом нужно включить DOCKER_CONTENT_TRUST

![Включаем docker_content_trust и билдим образ](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2034.png)

Включаем docker_content_trust и билдим образ

## **Part 6. Basic Docker Compose**

![Билдим образы согласно docker-compose.yml](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2035.png)

Билдим образы согласно docker-compose.yml

![Созданные образы](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2036.png)

Созданные образы

![Создаем контейнеры с помощью docker-compose up](Docker%20Project%207234568cde6b4e42b7502bc42e95ccf3/Untitled%2037.png)

Создаем контейнеры с помощью docker-compose up